<?php

// I hate notice errors
ini_set('error_reporting', ini_get('error_reporting') & ~E_NOTICE);

require_once DRUPAL_ROOT . "/sites/all/modules/_custom/sirius_bulk/sirius_bulk.permission.inc";
require_once DRUPAL_ROOT . "/sites/all/modules/_custom/sirius_bulk/sirius_bulk.menu.inc";
require_once DRUPAL_ROOT . "/sites/all/modules/_custom/sirius_bulk/sirius_bulk.admin.inc";
require_once DRUPAL_ROOT . "/sites/all/modules/_custom/sirius_bulk/sirius_bulk.vbo.inc";
require_once DRUPAL_ROOT . "/sites/all/modules/_custom/sirius_bulk/sirius_bulk.deliver.inc";
require_once DRUPAL_ROOT . "/sites/all/modules/_custom/sirius_bulk/sirius_bulk.oneclick.inc";

require_once DRUPAL_ROOT . "/sites/all/modules/_custom/sirius_bulk/sirius_bulk.page_recipients.inc";
require_once DRUPAL_ROOT . "/sites/all/modules/_custom/sirius_bulk/sirius_bulk.page_recipients_workers.inc";
require_once DRUPAL_ROOT . "/sites/all/modules/_custom/sirius_bulk/sirius_bulk.page_recipients_contacts.inc";
require_once DRUPAL_ROOT . "/sites/all/modules/_custom/sirius_bulk/sirius_bulk.page_queue.inc";
require_once DRUPAL_ROOT . "/sites/all/modules/_custom/sirius_bulk/sirius_bulk.page_test.inc";
require_once DRUPAL_ROOT . "/sites/all/modules/_custom/sirius_bulk/sirius_bulk.page_oneclick.inc";

/**
 * Implements hook_cron()
 */

function sirius_bulk_cron() {
	sirius_bulk_deliver();
}

function sirius_bulk_form_alter(&$form, &$form_state, $form_id) {
  if ($form_id == 'sirius_bulk_node_form') {

  	$form['body']['#states'] = array(
			'visible' => array(
				array(':input[name="field_sirius_bulk_medium[und]"]' => array('value' => 'email')),
				'or',
				array(':input[name="field_sirius_bulk_medium[und]"]' => array('value' => 'choice')),
			)
  	);

  	$form['field_sirius_sms']['#states'] = array(
			'visible' => array(
				array(':input[name="field_sirius_bulk_medium[und]"]' => array('value' => 'sms')),
				'or',
				array(':input[name="field_sirius_bulk_medium[und]"]' => array('value' => 'choice')),
			)
  	);

  	$form['field_sirius_voice']['#states'] = array(
			'visible' => array(
				array(':input[name="field_sirius_bulk_medium[und]"]' => array('value' => 'voice')),
				'or',
				array(':input[name="field_sirius_bulk_medium[und]"]' => array('value' => 'choice')),
			)
  	);
  }
}

/**
 * Implement hook_views_pre_render
 */

function sirius_bulk_views_pre_render(&$view) {
	if ($view->name == 'sirius_bulkmsg') {
		$bulk_node = menu_get_object();
		if ($bulk_node && $bulk_node->type == 'sirius_bulk') {
			if ($view->result) {
				foreach ($view->result as &$row) {
					$row->sirius_bulk_nid = $bulk_node->nid;
				}
			}
		}
	}
}